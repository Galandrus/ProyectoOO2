{"ast":null,"code":"import XPathInterpreter from './refactorings/XPathInterpreter'; //TODO: somehow, the file is realoded and that makes it impossible to remove listeners :(\n\nconsole.log(\"\\n\\n\\n********* LOADING THE 'PAGE SELECTOR' FILE *********\\n\\n\\n\");\nvar scrappers = {\n  // Because we can not use window instead\n  \"XpathScrapper\": function XpathScrapper() {\n    this.getElements = function (selector) {\n      return new XPathInterpreter().getElementsByXpath(selector, document);\n    };\n\n    this.getElement = function (selector) {\n      if (selector == undefined) return;\n      var elems = new XPathInterpreter().getElementsByXpath(selector, document);\n      return elems && elems.length > 0 ? elems[0] : undefined; //(new XPathInterpreter()).getElementByXPath(selector, document);\n    };\n  },\n  \"QuerySelectorScrapper\": function QuerySelectorScrapper() {\n    this.getElements = function (selector) {\n      return document.querySelectorAll(selector);\n    };\n\n    this.getElement = function (selector) {\n      if (selector == undefined) return;\n      return document.querySelector(selector);\n    };\n  }\n};\n\nfunction PageSelector(aComponent) {\n  //this.createEventListeners();\n  this.selectableElemClass = \"andes-selectable\";\n  this.onHoverHighlightClass = \"andes-highlighted-on-hover\";\n  this.selectionClass = \"andes-selected\";\n  this.clearBackgroundClass = \"andes-clear-background\";\n  this.obfuscatedClass = \"andes-blurred\";\n  this.onElementSelectionMessage = null;\n  this.loadListeners(aComponent);\n  this.selectedElem = null;\n}\n\n;\n\nPageSelector.prototype.getSetOfXPathsByOccurrences = function (element, relativeElem, generateRelativeSelector, relativeElements) {\n  var xpi = new XPathInterpreter(),\n      labeledXpaths = {},\n      xpaths;\n\n  if (this.justFullPaths) {\n    //Input y trigger\n    xpaths = xpi.getMultipleFullPaths(element, relativeElem);\n  } else {\n    if (generateRelativeSelector) {\n      // properties\n      var matchingRelativeElem;\n\n      for (var i = relativeElements.length - 1; i >= 0; i--) {\n        if (relativeElements[i].contains(element)) {\n          matchingRelativeElem = relativeElements[i];\n          break;\n        }\n      }\n\n      if (matchingRelativeElem) xpaths = xpi.getMultipleRelativeXPaths(element, matchingRelativeElem, this.generatesSingleElemSelectors);else xpaths = [];\n    } else {\n      console.log(\"getMultipleXPaths\");\n      xpaths = xpi.getMultipleXPaths(element, element.ownerDocument, this.generatesSingleElemSelectors);\n    }\n  }\n\n  if (xpaths && xpaths.length) {\n    for (var i = xpaths.length - 1; i >= 0; i--) {\n      if (!xpaths[i].includes(\"andes-\")) {\n        var elemsBySelector = xpi.getElementsByXpath(xpaths[i], element.ownerDocument).length;\n\n        if (elemsBySelector > 0) {\n          if (labeledXpaths[elemsBySelector]) this.addToExistingLabeledXpath(elemsBySelector, xpaths[i], labeledXpaths);else this.createNewLabeledXpath(elemsBySelector, xpaths[i], labeledXpaths);\n        }\n      }\n    }\n  }\n\n  return labeledXpaths;\n};\n\nPageSelector.prototype.addToExistingLabeledXpath = function (ocurrences, xpath, labeledXpaths) {\n  var xpaths = labeledXpaths[ocurrences]; //console.log(\"existing\", xpaths, \" with \", xpath);\n\n  xpaths.push(xpath);\n  labeledXpaths[ocurrences] = xpaths;\n};\n\nPageSelector.prototype.createNewLabeledXpath = function (ocurrences, xpath, labeledXpaths) {\n  labeledXpaths[ocurrences] = [xpath];\n};\n\nPageSelector.prototype.loadListeners = function (aComponent) {\n  var me = this;\n\n  this.selectionListener = function (evt) {\n    var matchingElements = me.withParentElements(me.selectedElem);\n    me.removeHighlightingOnHover(me.selectedElem);\n    matchingElements.forEach(function (targetElem) {\n      me.removeStyleClass(targetElem, me.selectionClass);\n      me.removeStyleClass(targetElem, me.clearBackgroundClass);\n    });\n    console.log(\"element selected\");\n    aComponent.onElementSelected(me.selectedElem);\n    /**me.generatePreview(me.selectedElem).then(function(preview){\n    \t\tme.removeStyleClass(me.selectedElem, me.selectableElemClass);\n    \tme.removeStyleClass(me.selectedElem, me.clearBackgroundClass);\n    \t\tvar selectors = me.getSetOfXPathsByOccurrences(me.selectedElem, me.refElem, me.generateRelativeSelector, me.refElems);\n    \t\n    \tconsole.log(selectors);\n    \tme.addStyleClass(me.selectedElem, me.selectableElemClass);\n    \tme.addHighlightingOnHover(me.selectedElem);\n    \t\tbrowser.runtime.sendMessage({\n    \t\t\"call\": evt.params.onElementSelection,\n    \t\t\"args\": {\n    \t\t\t\"selectors\": selectors, \n    \t\t\t\"previewSource\": preview,\n    \t\t\t\"scoped\": evt.params.scoped,\n    \t\t\t\"exampleValue\": (me.selectedElem.textContent)? me.selectedElem.textContent.trim() : \"\",\n    \t\t\t\"call\": evt.params.onElementSelection\n    \t\t}\n    \t});\n    })\t*/\n  };\n\n  this.mouseEnterSelection = function (evt) {\n    evt.preventDefault();\n    evt.stopImmediatePropagation(); //me.selectedElem = evt.target;\n    //console.log(me.selectedElem);\n\n    me.addStyleClass(this, me.onHoverHighlightClass);\n  };\n\n  this.withParentElements = function (element) {\n    var nodes = [];\n    nodes.push(element);\n\n    while (element.parentNode) {\n      nodes.unshift(element.parentNode);\n      element = element.parentNode;\n    }\n\n    return nodes;\n  };\n\n  this.mouseLeaveSelection = function (evt) {\n    me.removeStyleClass(this, me.onHoverHighlightClass);\n    evt.preventDefault();\n    evt.stopImmediatePropagation();\n  };\n\n  this.preventAnyAction = function (evt) {\n    evt.preventDefault();\n    evt.stopImmediatePropagation();\n    return false; //This is for preventing anchors\n  };\n\n  this.preventActionsListener = function (evt) {\n    evt.preventDefault();\n    evt.stopImmediatePropagation();\n    me.selectedElem = this; //evt.target;\n\n    if (me.selectedElem) {\n      if (me.hasAugmentedAction(me.selectedElem)) {\n        console.log(\"preventActionsListener\");\n        me.executeAugmentedActions({\n          \"target\": me.selectedElem,\n          \"type\": evt.type\n        });\n      }\n    }\n\n    return false;\n  };\n};\n\nPageSelector.prototype.getAllVisibleDomElements = function () {\n  return document.querySelectorAll(\"body, input, div, a, img, span, label, ul, li, p, pre, cite, em\"); //:not(.first)\n};\n\nPageSelector.prototype.getAllVisibleDomElementsButBody = function () {\n  return document.querySelectorAll(\"div, input, a, img, span, label, ul, li, p, pre, cite, em, form, select, h1, h2, h3, h4, h5, h6\"); //:not(.first)\n};\n\nPageSelector.prototype.getCurrentSidebarElements = function () {\n  return document.querySelector(\"#refactoring-extension-root\").querySelectorAll(\"*\");\n};\n\nPageSelector.prototype.highlightMatchingElements = function (data) {\n  /*var elems = (new XPathInterpreter()).getElementsByXpath(data.xpath, document);\n  for (var i = elems.length - 1; i >= 0; i--) {\n  \tthis.addSelectionClass(elems[i]);\n  }*/\n};\n\nPageSelector.prototype.selectMatchingElements = function (data) {\n  if (data.removeFullSelectionStyle) this.removeFullSelectionStyle();\n  var refElem = data.scrapper && data.refElemSelector ? new scrappers[data.scrapper]().getElement(data.refElemSelector) : document;\n  var elems = new XPathInterpreter().getElementsByXpath(data.selector, refElem);\n\n  for (var i = elems.length - 1; i >= 0; i--) {\n    this.addSelectionClass(elems[i]);\n  }\n\n  ;\n};\n\nPageSelector.prototype.preventDomElementsBehaviour = function () {\n  var me = this;\n  this.preventFormsOnSubmit();\n  this.getAllVisibleDomElementsButBody().forEach(function (elem) {\n    elem.addEventListener(\"click\", me.preventActionsListener, false);\n    me.getEventsNamesToPrevent().forEach(function (eventToPrevent) {\n      elem.addEventListener(eventToPrevent, me.preventAnyAction, false);\n    });\n  });\n};\n\nPageSelector.prototype.preventFormsOnSubmit = function () {\n  //TODO: it is not working with \"addEventListener\". This is a problem because maybe we can not resore the original behaviour after this\n  document.querySelectorAll(\"form\").forEach(function (form) {\n    form.onsubmit = function (evt) {\n      return false;\n    };\n  });\n};\n\nPageSelector.prototype.restoreDomElementsBehaviour = function () {\n  this.removeAllAugmentedActions();\n  var me = this; ///////THIS MAY BE A PROBLEM FOR THE SIDEBAR IF THIS METHOD IS CALLED IN THE MIDDLE OF THE PROCESS\n\n  this.getAllVisibleDomElementsButBody().forEach(function (elem) {\n    elem.removeEventListener(\"click\", me.preventActionsListener, false);\n    me.getEventsNamesToPrevent().forEach(function (eventToPrevent) {\n      elem.removeEventListener(eventToPrevent, me.preventAnyAction, false);\n    });\n    me.removeHighlightingOnHover(elem);\n  });\n  this.removeFullSelectionStyle();\n};\n\nPageSelector.prototype.removeAugmentedActions = function (elem) {\n  elem.removeAttribute(\"andes-actions\");\n};\n\nPageSelector.prototype.removeAllAugmentedActions = function (elem) {\n  document.querySelectorAll(\"*[andes-actions]\").forEach(function (e) {\n    return e.removeAttribute(\"andes-actions\");\n  });\n};\n\nPageSelector.prototype.getEventsNamesToPrevent = function () {\n  return [\"click\", \"mouseup\", \"mousedown\"]; //, \"keydown\", \"keyup\", \"keypress\",\n};\n\nPageSelector.prototype.getTargetElements = function (selector) {\n  return document.querySelectorAll(selector);\n};\n\nPageSelector.prototype.enableFullPathElementSelection = function (data) {\n  this.darkifyAllDomElements();\n  this.preventFormsOnSubmit();\n  this.lastUsedExtractor = new scrappers[data.scrapperClass]();\n  this.generatesSingleElemSelectors = data.generatesSingleElemSelectors;\n  var elements = this.lastUsedExtractor.getElements(data.targetElementSelector);\n  this.refElem = this.lastUsedExtractor.getElement(data.refElemSelector);\n  this.onElementSelectionMessage = data.onElementSelection;\n  this.addSelectionListener(elements, data.onElementSelection, \"click\", data.scoped, data.removeStyleOnSelection, data.generateRelativeSelector, data\n  /*este solo es laposta*/\n  );\n  this.undarkifySidebarElements();\n  this.darkify(document.body);\n};\n\nPageSelector.prototype.enableElementSelection = function (data) {\n  this.darkifyAllDomElements();\n  this.preventFormsOnSubmit();\n  this.lastUsedExtractor = new scrappers[data.scrapperClass]();\n  this.generatesSingleElemSelectors = data.generatesSingleElemSelectors;\n  var elements = this.lastUsedExtractor.getElements(data.targetElementSelector);\n  this.refElem = this.lastUsedExtractor.getElement(data.refElemSelector);\n  this.refElems = this.lastUsedExtractor.getElements(data.refElemSelector);\n  this.onElementSelectionMessage = data.onElementSelection;\n  this.justFullPaths = data.justFullPaths;\n  this.addSelectionListener(elements, data.onElementSelection, \"click\", data.scoped, data.removeStyleOnSelection, data.generateRelativeSelector, data\n  /*este solo es laposta*/\n  );\n  this.undarkifySidebarElements();\n  this.darkify(document.body);\n};\n\nPageSelector.prototype.disableElementSelection = function (data) {\n  this.undarkifyAllDomElements();\n  this.removeElemsHighlightingClass(data.selector);\n  this.removeHighlightingOnHoverFrom(data.selector);\n  this.removeAllAugmentedActions(); //TODO: do not just remove. add a default action (prevent)\n};\n\nPageSelector.prototype.darkifyAllDomElements = function () {\n  var me = this,\n      elems = this.getAllVisibleDomElements();\n  elems.forEach(function (elem) {\n    me.darkify(elem);\n  });\n};\n\nPageSelector.prototype.undarkifyAllDomElements = function () {\n  var me = this,\n      elems = this.getAllVisibleDomElements();\n  elems.forEach(function (elem) {\n    me.undarkify(elem);\n  });\n};\n\nPageSelector.prototype.removeElemsHighlightingClass = function (selector) {\n  var me = this,\n      elems = this.lastUsedExtractor.getElements(selector);\n  elems.forEach(function (elem) {\n    me.removeSelectableElemStyle(elem);\n  });\n};\n\nPageSelector.prototype.hasAugmentedAction = function (target) {\n  return this.getAugmentedActions(target).length > 0;\n};\n\nPageSelector.prototype.executeAugmentedActions = function (evt) {\n  var actions = this.getAugmentedActions(evt.target);\n\n  for (var i = actions.length - 1; i >= 0; i--) {\n    if (evt.type.toUpperCase() == actions[i].event.toUpperCase()) {\n      evt.params = actions[i].params;\n      this[actions[i].listener](evt); //e.g. \n    }\n  }\n};\n\nPageSelector.prototype.getAugmentedActions = function (elem) {\n  if (elem) {\n    var actions = elem.getAttribute(\"andes-actions\");\n    if (actions && actions.length) return actions = JSON.parse(actions);\n  }\n\n  return [];\n};\n\nPageSelector.prototype.isActionIncluded = function (existingAction, actions) {\n  for (var i = actions.length - 1; i >= 0; i--) {\n    if (actions[i].listener == existingAction.listener && actions[i].listener == existingAction.listener) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nPageSelector.prototype.addAugmentedAction = function (elem, action, params) {\n  var actions = this.getAugmentedActions(elem);\n\n  if (!this.isActionIncluded(action, actions)) {\n    actions.push(action);\n    elem.setAttribute(\"andes-actions\", JSON.stringify(actions));\n  }\n};\n\nPageSelector.prototype.addSelectionListener = function (elements, onElementSelection, onEvent, scoped, removeStyleOnSelection, generateRelativeSelector, data) {\n  var me = this;\n  this.removeStyleOnSelection = removeStyleOnSelection;\n  this.scoped = scoped;\n  this.generateRelativeSelector = generateRelativeSelector;\n  elements.forEach(function (elem) {\n    me.undarkify(elem);\n    me.addHighlightingOnHover(elem);\n    me.addSelectableElemStyle(elem);\n    me.addAugmentedAction(elem, {\n      \"listener\": \"selectionListener\",\n      \"event\": onEvent,\n      \"params\": data\n    });\n  });\n};\n\nPageSelector.prototype.addHighlightingOnHover = function (elem) {\n  elem.addEventListener(\"mouseover\", this.mouseEnterSelection, false);\n  elem.addEventListener(\"mouseleave\", this.mouseLeaveSelection, false);\n};\n\nPageSelector.prototype.removeHighlightingOnHover = function (elem) {\n  elem.removeEventListener(\"mouseover\", this.mouseEnterSelection, false);\n  elem.removeEventListener(\"mouseleave\", this.mouseLeaveSelection, false);\n  this.removeStyleClass(elem, this.onHoverHighlightClass);\n};\n\nPageSelector.prototype.addSelectableElemStyle = function (elem) {\n  this.addStyleClass(elem, this.selectableElemClass);\n};\n\nPageSelector.prototype.addSelectionClass = function (elem) {\n  this.addStyleClass(elem, this.selectionClass);\n};\n\nPageSelector.prototype.removeSelectionClass = function (elem) {\n  this.removeStyleClass(elem, this.selectionClass);\n};\n\nPageSelector.prototype.removeFullSelectionStyle = function () {\n  this.removeClassFromMatchingElements(this.obfuscatedClass);\n  this.removeClassFromMatchingElements(this.selectableElemClass);\n  this.removeClassFromMatchingElements(this.onHoverHighlightClass);\n  this.removeClassFromMatchingElements(this.clearBackgroundClass);\n  this.removeClassFromMatchingElements(this.selectionClass); //this.restoreDomElementsBehaviour();\n\n  return Promise.resolve();\n};\n\nPageSelector.prototype.removeHighlightingOnHoverFrom = function (selector) {\n  this.selectedElem = undefined;\n  var me = this;\n  this.lastUsedExtractor.getElements(selector).forEach(function (elem) {\n    me.removeHighlightingOnHover(elem);\n  });\n};\n\nPageSelector.prototype.removeEventBlockers = function () {\n  console.log(\"Removing event blockers\");\n};\n\nPageSelector.prototype.removeClassFromMatchingElements = function (className) {\n  var hElems = document.querySelectorAll(\".\" + className);\n  hElems.forEach(function (e) {\n    return e.classList.remove(className);\n  });\n  return hElems;\n};\n\nPageSelector.prototype.addClassToMatchingElements = function (elems, className) {\n  for (var i = 0; i < elems.length; i++) {\n    this.addStyleClass(elems[i], className);\n  }\n\n  return elems;\n};\n\nPageSelector.prototype.undarkifySidebarElements = function () {\n  var me = this;\n  this.getCurrentSidebarElements().forEach(function (elem) {\n    me.undarkify(elem);\n  });\n};\n\nPageSelector.prototype.isAVisibleElement = function (elem) {\n  return elem.style.display != \"none\" && elem.getBoundingClientRect().width != 0 ? true : false;\n};\n\nPageSelector.prototype.darkify = function (elem) {\n  this.addStyleClass(elem, this.obfuscatedClass);\n};\n\nPageSelector.prototype.addClearBackground = function (elem) {\n  this.addStyleClass(elem, this.clearBackgroundClass);\n};\n\nPageSelector.prototype.addStyleClass = function (elem, className) {\n  if (elem.classList && !elem.classList.contains(className)) {\n    elem.classList.add(className);\n  }\n};\n\nPageSelector.prototype.removeStyleClass = function (elem, className) {\n  if (elem && elem.classList && elem.classList.contains(className)) {\n    elem.classList.remove(className);\n  }\n};\n\nPageSelector.prototype.undarkify = function (elem) {\n  this.removeStyleClass(elem, this.obfuscatedClass);\n};\n\nPageSelector.prototype.removeSelectableElemStyle = function (elem) {\n  this.removeStyleClass(elem, this.selectableElemClass);\n};\n\nPageSelector.prototype.removeClearBackground = function (elem) {\n  this.removeStyleClass(elem, this.clearBackgroundClass);\n};\n\nexport default PageSelector;","map":{"version":3,"sources":["/Users/jcgardey/Sites/refactoring-react/src/PageSelector.js"],"names":["XPathInterpreter","console","log","scrappers","getElements","selector","getElementsByXpath","document","getElement","undefined","elems","length","querySelectorAll","querySelector","PageSelector","aComponent","selectableElemClass","onHoverHighlightClass","selectionClass","clearBackgroundClass","obfuscatedClass","onElementSelectionMessage","loadListeners","selectedElem","prototype","getSetOfXPathsByOccurrences","element","relativeElem","generateRelativeSelector","relativeElements","xpi","labeledXpaths","xpaths","justFullPaths","getMultipleFullPaths","matchingRelativeElem","i","contains","getMultipleRelativeXPaths","generatesSingleElemSelectors","getMultipleXPaths","ownerDocument","includes","elemsBySelector","addToExistingLabeledXpath","createNewLabeledXpath","ocurrences","xpath","push","me","selectionListener","evt","matchingElements","withParentElements","removeHighlightingOnHover","forEach","targetElem","removeStyleClass","onElementSelected","mouseEnterSelection","preventDefault","stopImmediatePropagation","addStyleClass","nodes","parentNode","unshift","mouseLeaveSelection","preventAnyAction","preventActionsListener","hasAugmentedAction","executeAugmentedActions","type","getAllVisibleDomElements","getAllVisibleDomElementsButBody","getCurrentSidebarElements","highlightMatchingElements","data","selectMatchingElements","removeFullSelectionStyle","refElem","scrapper","refElemSelector","addSelectionClass","preventDomElementsBehaviour","preventFormsOnSubmit","elem","addEventListener","getEventsNamesToPrevent","eventToPrevent","form","onsubmit","restoreDomElementsBehaviour","removeAllAugmentedActions","removeEventListener","removeAugmentedActions","removeAttribute","e","getTargetElements","enableFullPathElementSelection","darkifyAllDomElements","lastUsedExtractor","scrapperClass","elements","targetElementSelector","onElementSelection","addSelectionListener","scoped","removeStyleOnSelection","undarkifySidebarElements","darkify","body","enableElementSelection","refElems","disableElementSelection","undarkifyAllDomElements","removeElemsHighlightingClass","removeHighlightingOnHoverFrom","undarkify","removeSelectableElemStyle","target","getAugmentedActions","actions","toUpperCase","event","params","listener","getAttribute","JSON","parse","isActionIncluded","existingAction","addAugmentedAction","action","setAttribute","stringify","onEvent","addHighlightingOnHover","addSelectableElemStyle","removeSelectionClass","removeClassFromMatchingElements","Promise","resolve","removeEventBlockers","className","hElems","classList","remove","addClassToMatchingElements","isAVisibleElement","style","display","getBoundingClientRect","width","addClearBackground","add","removeClearBackground"],"mappings":"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","sourcesContent":["import XPathInterpreter from './refactorings/XPathInterpreter';\n\n//TODO: somehow, the file is realoded and that makes it impossible to remove listeners :(\nconsole.log(\"\\n\\n\\n********* LOADING THE 'PAGE SELECTOR' FILE *********\\n\\n\\n\");\n\n\nvar scrappers = { // Because we can not use window instead\n\t\"XpathScrapper\": function(){\n\t\tthis.getElements = function(selector){\n\t\t\treturn (new XPathInterpreter()).getElementsByXpath(selector, document);\n\t\t};\n\t\tthis.getElement = function(selector){\n\t\t\tif(selector == undefined)\n\t\t\t\treturn;\n\n\t\t\tvar elems = (new XPathInterpreter()).getElementsByXpath(selector, document);\n\t\t\treturn (elems && elems.length > 0)? elems[0] : undefined; //(new XPathInterpreter()).getElementByXPath(selector, document);\n\t\t};\n\t},\n\t\"QuerySelectorScrapper\": function(){\n\t\tthis.getElements = function(selector){\n\t\t\treturn document.querySelectorAll(selector);\n\t\t};\n\t\tthis.getElement = function(selector){\n\t\t\tif(selector == undefined)\n\t\t\t\treturn;\n\t\t\treturn document.querySelector(selector);\n\t\t};\n\t}\n}\n\nfunction PageSelector(aComponent){\n\t//this.createEventListeners();\n\tthis.selectableElemClass = \"andes-selectable\";\n\tthis.onHoverHighlightClass = \"andes-highlighted-on-hover\";\n\tthis.selectionClass = \"andes-selected\";\n\tthis.clearBackgroundClass = \"andes-clear-background\";\n\tthis.obfuscatedClass = \"andes-blurred\";\n\tthis.onElementSelectionMessage = null;\n\tthis.loadListeners(aComponent);\n\tthis.selectedElem = null;\n};\nPageSelector.prototype.getSetOfXPathsByOccurrences = function(element, relativeElem, generateRelativeSelector, relativeElements){\n\n\tvar xpi = new XPathInterpreter(), labeledXpaths = {}, xpaths;\n\n\tif(this.justFullPaths){\n\t\t//Input y trigger\n\t\txpaths = xpi.getMultipleFullPaths(element, relativeElem);\n\t}\n\telse {\n\t\tif(generateRelativeSelector){\n\t\t\t// properties\n\t\t\tvar matchingRelativeElem;\n\t\t\tfor (var i = relativeElements.length - 1; i >= 0; i--) {\n\t\t\t\tif(relativeElements[i].contains(element)){\n\t\t\t\t\tmatchingRelativeElem = relativeElements[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(matchingRelativeElem)\n\t\t\t\txpaths = xpi.getMultipleRelativeXPaths(element, matchingRelativeElem, this.generatesSingleElemSelectors);\n\t\t\telse xpaths = [];\n\t\t}\n\t\telse{\n\t\t\tconsole.log(\"getMultipleXPaths\");\n\t\t\txpaths = xpi.getMultipleXPaths(element, element.ownerDocument, this.generatesSingleElemSelectors);\n\t\t}\n\t}\n\n\tif(xpaths && xpaths.length){\n\t    for (var i = xpaths.length - 1; i >= 0; i--) {\n\n\t    \tif(!xpaths[i].includes(\"andes-\")){\n\n\t\t        var elemsBySelector = xpi.getElementsByXpath(xpaths[i], element.ownerDocument).length;\n\t\t        if(elemsBySelector > 0){\n\n\t\t            if(labeledXpaths[elemsBySelector])\n\t\t            \tthis.addToExistingLabeledXpath(elemsBySelector, xpaths[i], labeledXpaths)\n\t\t            else this.createNewLabeledXpath(elemsBySelector, xpaths[i], labeledXpaths); \n\t\t        }\n\t\t    }\n\t    }\n\t}\n\n    return labeledXpaths;\n}\nPageSelector.prototype.addToExistingLabeledXpath = function(ocurrences, xpath, labeledXpaths){\n\n\tvar xpaths = labeledXpaths[ocurrences]; \n\t//console.log(\"existing\", xpaths, \" with \", xpath);\n\t\txpaths.push(xpath);\n\n\tlabeledXpaths[ocurrences] = xpaths; \n}\nPageSelector.prototype.createNewLabeledXpath = function(ocurrences, xpath, labeledXpaths){\n\n\tlabeledXpaths[ocurrences] = [xpath]; \n}\nPageSelector.prototype.loadListeners = function(aComponent){\n\t\n\tvar me = this;\n\n\tthis.selectionListener = function(evt){\n\n\t\tvar matchingElements = me.withParentElements(me.selectedElem);\n\n\t\tme.removeHighlightingOnHover(me.selectedElem); \n\t\tmatchingElements.forEach(targetElem => {\n\t\t\tme.removeStyleClass(targetElem, me.selectionClass);\n\t\t\tme.removeStyleClass(targetElem, me.clearBackgroundClass);\n\t\t});\n\n\t\tconsole.log(\"element selected\");\n\n\t\taComponent.onElementSelected(me.selectedElem);\n\n\t\t/**me.generatePreview(me.selectedElem).then(function(preview){\n\n\t\t\tme.removeStyleClass(me.selectedElem, me.selectableElemClass);\n\t\t\tme.removeStyleClass(me.selectedElem, me.clearBackgroundClass);\n\n\t\t\tvar selectors = me.getSetOfXPathsByOccurrences(me.selectedElem, me.refElem, me.generateRelativeSelector, me.refElems);\n\t\t\t\n\t\t\tconsole.log(selectors);\n\t\t\tme.addStyleClass(me.selectedElem, me.selectableElemClass);\n\t\t\tme.addHighlightingOnHover(me.selectedElem);\n\n\t\t\tbrowser.runtime.sendMessage({\n\t\t\t\t\"call\": evt.params.onElementSelection,\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"selectors\": selectors, \n\t\t\t\t\t\"previewSource\": preview,\n\t\t\t\t\t\"scoped\": evt.params.scoped,\n\t\t\t\t\t\"exampleValue\": (me.selectedElem.textContent)? me.selectedElem.textContent.trim() : \"\",\n\t\t\t\t\t\"call\": evt.params.onElementSelection\n\t\t\t\t}\n\t\t\t});\n\t\t})\t*/\n\t};\n\tthis.mouseEnterSelection = function(evt) {  \n\n\t\tevt.preventDefault(); evt.stopImmediatePropagation();\n\t\t//me.selectedElem = evt.target;\n\t\t//console.log(me.selectedElem);\n\t\tme.addStyleClass(this, me.onHoverHighlightClass);\n\t};\n\tthis.withParentElements = function(element){\n\n\t\tvar nodes = [];\n\t\tnodes.push(element);\n\t\twhile(element.parentNode) {\n\t\t    nodes.unshift(element.parentNode);\n\t\t    element = element.parentNode;\n\t\t}\n\t\treturn nodes;\n\t};\n\tthis.mouseLeaveSelection = function(evt) {  \n\n\t\tme.removeStyleClass(this, me.onHoverHighlightClass);\n\t\tevt.preventDefault(); evt.stopImmediatePropagation();\n\t};\n\tthis.preventAnyAction = function(evt){\n\t\t\n\t\tevt.preventDefault(); evt.stopImmediatePropagation();\n\t\treturn false; //This is for preventing anchors\n\t};\n\tthis.preventActionsListener = function(evt){\n\t\t\n\t\tevt.preventDefault(); evt.stopImmediatePropagation();\n\t\tme.selectedElem = this; //evt.target;\n\t\t\n\t\tif(me.selectedElem ) {\n\t\t\tif(me.hasAugmentedAction(me.selectedElem)){\n\t\t\t\tconsole.log(\"preventActionsListener\");\n\t\t\t\tme.executeAugmentedActions({\"target\": me.selectedElem, \"type\": evt.type});\n\t\t\t}\n\t\t} \n\n\t\treturn false; \n\t};\n};\nPageSelector.prototype.getAllVisibleDomElements = function(){\n\treturn document.querySelectorAll(\"body, input, div, a, img, span, label, ul, li, p, pre, cite, em\"); //:not(.first)\n};\nPageSelector.prototype.getAllVisibleDomElementsButBody = function(){\n\treturn document.querySelectorAll(\"div, input, a, img, span, label, ul, li, p, pre, cite, em, form, select, h1, h2, h3, h4, h5, h6\"); //:not(.first)\n};\nPageSelector.prototype.getCurrentSidebarElements = function(){\n\t\n\treturn document.querySelector(\"#refactoring-extension-root\").querySelectorAll(\"*\");\n};\nPageSelector.prototype.highlightMatchingElements = function(data){\n\n\t/*var elems = (new XPathInterpreter()).getElementsByXpath(data.xpath, document);\n\tfor (var i = elems.length - 1; i >= 0; i--) {\n\t\tthis.addSelectionClass(elems[i]);\n\t}*/\n};\nPageSelector.prototype.selectMatchingElements = function(data){\n\n\tif(data.removeFullSelectionStyle)\n\t\tthis.removeFullSelectionStyle();\n\t\n\tvar refElem = (data.scrapper && data.refElemSelector)? (new scrappers[data.scrapper]()).getElement(data.refElemSelector) : document;\n\n\tvar elems = (new XPathInterpreter()).getElementsByXpath(data.selector, refElem);\n\tfor (var i = elems.length - 1; i >= 0; i--) {\n\t\tthis.addSelectionClass(elems[i]);\n\t};\n};\nPageSelector.prototype.preventDomElementsBehaviour = function(){\n\n\tvar me=this;\n\tthis.preventFormsOnSubmit();\n\tthis.getAllVisibleDomElementsButBody().forEach(function(elem){\n\t\t\n\t\telem.addEventListener(\"click\", me.preventActionsListener, false);\n\t\tme.getEventsNamesToPrevent().forEach(function(eventToPrevent){\n\t\t\telem.addEventListener(eventToPrevent, me.preventAnyAction, false);\n\t\t});\n\t});\n};\nPageSelector.prototype.preventFormsOnSubmit = function(){\n\n\t//TODO: it is not working with \"addEventListener\". This is a problem because maybe we can not resore the original behaviour after this\n\tdocument.querySelectorAll(\"form\").forEach(function(form){ \n\t\tform.onsubmit = function(evt){ \n    \t\treturn false;\n\t\t}; \n    });\n}\nPageSelector.prototype.restoreDomElementsBehaviour = function(){\n\n\tthis.removeAllAugmentedActions();\n\n\tvar me=this; ///////THIS MAY BE A PROBLEM FOR THE SIDEBAR IF THIS METHOD IS CALLED IN THE MIDDLE OF THE PROCESS\n\tthis.getAllVisibleDomElementsButBody().forEach(function(elem){\n\n\t\telem.removeEventListener(\"click\", me.preventActionsListener, false);\n\t\tme.getEventsNamesToPrevent().forEach(function(eventToPrevent){\n\t\t\telem.removeEventListener(eventToPrevent, me.preventAnyAction, false);\n\t\t});\t\t\n\t\tme.removeHighlightingOnHover(elem);\n\t});\n\n\tthis.removeFullSelectionStyle();\n};\nPageSelector.prototype.removeAugmentedActions = function(elem){\n\t\n\telem.removeAttribute(\"andes-actions\");\n};\nPageSelector.prototype.removeAllAugmentedActions = function(elem){\n\t\n\tdocument.querySelectorAll(\"*[andes-actions]\").forEach(e => e.removeAttribute(\"andes-actions\"));\n};\nPageSelector.prototype.getEventsNamesToPrevent = function(){\n\t\n\treturn [\"click\", \"mouseup\", \"mousedown\"]; //, \"keydown\", \"keyup\", \"keypress\",\n};\nPageSelector.prototype.getTargetElements = function(selector){\n\t\n\treturn document.querySelectorAll(selector);\n};\nPageSelector.prototype.enableFullPathElementSelection = function(data){\n\n\tthis.darkifyAllDomElements();\n\tthis.preventFormsOnSubmit();\n\n\tthis.lastUsedExtractor = new scrappers[data.scrapperClass]();\n\tthis.generatesSingleElemSelectors = data.generatesSingleElemSelectors;\n\tvar elements = this.lastUsedExtractor.getElements(data.targetElementSelector);\n\tthis.refElem = this.lastUsedExtractor.getElement(data.refElemSelector);\n\n\tthis.onElementSelectionMessage = data.onElementSelection;\n\n    this.addSelectionListener(\n    \telements, \n    \tdata.onElementSelection, \n    \t\"click\", \n    \tdata.scoped,\n    \tdata.removeStyleOnSelection,\n    \tdata.generateRelativeSelector,\n    \tdata /*este solo es laposta*/\n    );\n    this.undarkifySidebarElements();\n    this.darkify(document.body); \n};\nPageSelector.prototype.enableElementSelection = function(data){\n\n\tthis.darkifyAllDomElements();\n\tthis.preventFormsOnSubmit();\n\n\tthis.lastUsedExtractor = new scrappers[data.scrapperClass]();\n\tthis.generatesSingleElemSelectors = data.generatesSingleElemSelectors;\n\tvar elements = this.lastUsedExtractor.getElements(data.targetElementSelector);\n\tthis.refElem = this.lastUsedExtractor.getElement(data.refElemSelector);\n\tthis.refElems = this.lastUsedExtractor.getElements(data.refElemSelector);\n\tthis.onElementSelectionMessage = data.onElementSelection;\n\tthis.justFullPaths = data.justFullPaths;\n\n    this.addSelectionListener(\n    \telements, \n    \tdata.onElementSelection, \n    \t\"click\", \n    \tdata.scoped,\n    \tdata.removeStyleOnSelection,\n    \tdata.generateRelativeSelector,\n    \tdata /*este solo es laposta*/\n    );\n    this.undarkifySidebarElements();\n    this.darkify(document.body); \n};\nPageSelector.prototype.disableElementSelection = function(data){\n\n\tthis.undarkifyAllDomElements();\n\tthis.removeElemsHighlightingClass(data.selector);\n\tthis.removeHighlightingOnHoverFrom(data.selector);\n    this.removeAllAugmentedActions(); //TODO: do not just remove. add a default action (prevent)\n};\nPageSelector.prototype.darkifyAllDomElements = function(){\n\n\tvar me = this, elems = this.getAllVisibleDomElements(); \n\telems.forEach(function(elem) { \n\t\tme.darkify(elem);\n    });\n}\nPageSelector.prototype.undarkifyAllDomElements = function(){\n\n\tvar me = this, elems = this.getAllVisibleDomElements(); \n\telems.forEach(function(elem) { \n\t\tme.undarkify(elem);\n    });\n}\nPageSelector.prototype.removeElemsHighlightingClass = function(selector){\n\n\tvar me = this, elems = this.lastUsedExtractor.getElements(selector); \n\telems.forEach(function(elem) { \n\t\tme.removeSelectableElemStyle(elem);\n    });\n}\nPageSelector.prototype.hasAugmentedAction = function(target){\n\n\treturn (this.getAugmentedActions(target).length > 0);\t\n}\nPageSelector.prototype.executeAugmentedActions = function(evt){\n\n\tvar actions = this.getAugmentedActions(evt.target);\n\t\n\tfor (var i = actions.length - 1; i >= 0; i--) {\n\t\tif(evt.type.toUpperCase() == actions[i].event.toUpperCase()){\n\t\t\tevt.params = actions[i].params;\n\t\t\tthis[actions[i].listener](evt); //e.g. \n\t\t}\n\t}\n}\nPageSelector.prototype.getAugmentedActions = function(elem){\n\n\tif (elem){\n\t\tvar actions = elem.getAttribute(\"andes-actions\");\n\t\tif (actions && actions.length)\n\t\t\treturn actions=JSON.parse(actions);\n\t}\n\treturn [];\n}\nPageSelector.prototype.isActionIncluded = function(existingAction, actions){\n\n\tfor (var i = actions.length - 1; i >= 0; i--) {\n\t\tif(actions[i].listener == existingAction.listener && actions[i].listener == existingAction.listener){\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\nPageSelector.prototype.addAugmentedAction = function(elem, action, params){\n\n\tvar actions = this.getAugmentedActions(elem);\n\tif(!this.isActionIncluded(action, actions)) {\n\t\tactions.push(action);\n\t\telem.setAttribute(\"andes-actions\", JSON.stringify(actions));\n\t}\n}\nPageSelector.prototype.addSelectionListener = function(elements, onElementSelection, onEvent, scoped, \n\tremoveStyleOnSelection, generateRelativeSelector, data){\n\n\tvar me = this;\n\n\t\tthis.removeStyleOnSelection = removeStyleOnSelection;\n\t\tthis.scoped = scoped;\n\t\tthis.generateRelativeSelector = generateRelativeSelector;\n\n\telements.forEach(function(elem) { \n\t\tme.undarkify(elem);\t\n\t\tme.addHighlightingOnHover(elem);\n\t\tme.addSelectableElemStyle(elem);\n\t\tme.addAugmentedAction(elem, {\n\t\t\t\"listener\": \"selectionListener\", \n\t\t\t\"event\": onEvent, \n\t\t\t\"params\": data\n\t\t});\n    });\t\n}\n\nPageSelector.prototype.addHighlightingOnHover = function(elem){\n\telem.addEventListener(\"mouseover\", this.mouseEnterSelection, false);\n\telem.addEventListener(\"mouseleave\", this.mouseLeaveSelection, false);\n}\nPageSelector.prototype.removeHighlightingOnHover = function(elem){\n\n\telem.removeEventListener(\"mouseover\", this.mouseEnterSelection, false);\n\telem.removeEventListener(\"mouseleave\", this.mouseLeaveSelection, false);\n\tthis.removeStyleClass(elem, this.onHoverHighlightClass);\n}\nPageSelector.prototype.addSelectableElemStyle = function(elem){\n\n\tthis.addStyleClass(elem, this.selectableElemClass);  \n}\nPageSelector.prototype.addSelectionClass = function(elem){\n\n\tthis.addStyleClass(elem, this.selectionClass);  \n}\nPageSelector.prototype.removeSelectionClass = function(elem){\n\n\tthis.removeStyleClass(elem, this.selectionClass);  \n}\nPageSelector.prototype.removeFullSelectionStyle = function(){\n\n\tthis.removeClassFromMatchingElements(this.obfuscatedClass);\n\tthis.removeClassFromMatchingElements(this.selectableElemClass);\n\tthis.removeClassFromMatchingElements(this.onHoverHighlightClass);\n\tthis.removeClassFromMatchingElements(this.clearBackgroundClass);\n\tthis.removeClassFromMatchingElements(this.selectionClass);\n\t//this.restoreDomElementsBehaviour();\n\n\treturn Promise.resolve();\n}\nPageSelector.prototype.removeHighlightingOnHoverFrom = function(selector){\n\t\n\tthis.selectedElem = undefined;\n\n\tvar me = this;\n\t(this.lastUsedExtractor.getElements(selector)).forEach(function(elem){\n\t\tme.removeHighlightingOnHover(elem);\n\t});\n}\nPageSelector.prototype.removeEventBlockers = function(){\n\n\tconsole.log(\"Removing event blockers\");\n}\nPageSelector.prototype.removeClassFromMatchingElements = function(className){\n\n\tvar hElems = document.querySelectorAll(\".\" + className);\n\t\thElems.forEach(e => e.classList.remove(className));\n\treturn hElems;\n}\nPageSelector.prototype.addClassToMatchingElements = function(elems, className){\n\n\tfor (var i = 0; i < elems.length; i++) {\n\t\tthis.addStyleClass(elems[i], className);\n\t}\n\treturn elems;\n}\nPageSelector.prototype.undarkifySidebarElements = function(){\n\n\tvar me = this;\n\tthis.getCurrentSidebarElements().forEach(function(elem) { \n\t\tme.undarkify(elem);\t\t\n    });\n}\nPageSelector.prototype.isAVisibleElement = function(elem){\n\n\treturn (elem.style.display != \"none\" && elem.getBoundingClientRect().width != 0)? true : false;\n}\nPageSelector.prototype.darkify = function(elem){\n\n\tthis.addStyleClass(elem, this.obfuscatedClass);\n};\nPageSelector.prototype.addClearBackground = function(elem){\n\t\n\tthis.addStyleClass(elem, this.clearBackgroundClass);\n};\nPageSelector.prototype.addStyleClass = function(elem, className){\n\n\tif(elem.classList && !elem.classList.contains(className)){\n\t\telem.classList.add(className);\n\t}\n};\nPageSelector.prototype.removeStyleClass = function(elem, className){\n\t\n\tif(elem && elem.classList && elem.classList.contains(className)){\n\t\telem.classList.remove(className);\n\t}\n};\nPageSelector.prototype.undarkify = function(elem){\n\t\n\tthis.removeStyleClass(elem, this.obfuscatedClass);\n};\nPageSelector.prototype.removeSelectableElemStyle = function(elem){\n\t\n\tthis.removeStyleClass(elem, this.selectableElemClass);\t\n};\nPageSelector.prototype.removeClearBackground = function(elem){\n\t\n\tthis.removeStyleClass(elem, this.clearBackgroundClass);\t\n};\n\nexport default PageSelector;"]},"metadata":{},"sourceType":"module"}